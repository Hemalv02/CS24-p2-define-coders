datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

model User {
    id             String  @id @default(uuid())
    username       String  @unique
    email          String  @unique
    hashedPassword String
    profileName    String?
    profileImage   String?
    role           Role    @relation(fields: [roleName], references: [name])
    roleName       String  @default("UNASSIGNED")
    sts            STS?    @relation(fields: [stsId], references: [id])
    stsId          String?

    landfill   Landfill? @relation(fields: [landfillId], references: [id])
    landfillId String?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([username], name: "username_index")
    @@index([email], name: "email_index")
}

model Role {
    id          String  @id @default(uuid())
    name        String  @unique
    description String?
    User        User[]

    permissions Permission[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Permission {
    id          String  @id @default(uuid())
    name        String  @unique
    description String?
    roles       Role[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Vehicle {
    id                    String   @id @default(uuid())
    vehicleNumber         String   @unique
    vehicleType           String
    capacity              Decimal
    loadedFuelCostPerKm   Decimal
    unloadedFuelCostPerKm Decimal
    currentLatitude       Decimal?
    currentLongitude      Decimal?

    landFill             Landfill               @relation(fields: [landFillId], references: [id])
    landFillId           String
    STSVehicleEntry      STSVehicleEntry[]
    LandfillVehicleEntry LandfillVehicleEntry[]
    Bill                 Bill[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    Trip      Trip[]
}

model STS {
    id                String   @id @default(uuid())
    name              String?
    wardNumber        String?
    capacity          Decimal?
    currentTotalWaste Decimal?
    latitude          Decimal
    longitude         Decimal

    STSVehicleEntry STSVehicleEntry[]
    manager         User[]
    Trip            Trip[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    Bill      Bill[]
}

model Landfill {
    id                  String   @id @default(uuid())
    name                String?
    capacity            Decimal?
    currentTotalWaste   Decimal?
    operationalTimeSpan String? // ask about this
    latitude            Decimal
    longitude           Decimal

    LandfillVehicleEntry LandfillVehicleEntry[]
    manager              User[]
    Trip                 Trip[]

    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
    Bill      Bill[]
    Vehicle   Vehicle[]
}

model STSVehicleEntry {
    id            String    @id @default(uuid())
    sts           STS       @relation(fields: [stsId], references: [id])
    stsId         String
    vehicle       Vehicle   @relation(fields: [vehicleId], references: [id])
    vehicleId     String
    weightOfWaste Decimal?
    entryTime     DateTime?
    exitTime      DateTime?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model LandfillVehicleEntry {
    id            String    @id @default(uuid())
    landfill      Landfill  @relation(fields: [landfillId], references: [id])
    landfillId    String
    vehicle       Vehicle   @relation(fields: [vehicleId], references: [id])
    vehicleId     String
    weightOfWaste Decimal?
    entryTime     DateTime?
    exitTime      DateTime?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Bill {
    id        String  @id @default(uuid())
    billNo    Int     @unique @default(autoincrement())
    vehicle   Vehicle @relation(fields: [vehicleId], references: [id])
    vehicleId String
    sts       STS     @relation(fields: [stsId], references: [id])
    stsId     String

    landfill   Landfill @relation(fields: [landfillId], references: [id])
    landfillId String

    trip   Trip?   @relation(fields: [tripId], references: [id])
    tripId String?

    weightOfWaste     Decimal?
    allocatedFuelCost Decimal?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Trip {
    id         String   @id @default(uuid())
    sts        STS      @relation(fields: [stsId], references: [id])
    stsId      String
    landfill   Landfill @relation(fields: [landfillId], references: [id])
    landfillId String
    vehicle    Vehicle  @relation(fields: [vehicleId], references: [id])
    vehicleId  String

    tripStartTime     DateTime?
    tripEndTime       DateTime?
    weightOfWaste     Decimal?
    shortage          Decimal?
    estimatedFuelCost Decimal?

    distance          Decimal?
    estimatedDuration Decimal?
    actualDuration    Decimal?

    tripStatus String?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    Bill      Bill[]
}
